{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useContext, useState, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport api from \"../services/api\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext({});\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  var signIn = useCallback(function () {\n    var _ref2 = _asyncToGenerator(function* (email, password) {\n      try {\n        setLoading(true);\n        var response = yield api.post('/api/auth/login', {\n          email: email,\n          password: password\n        });\n        var _response$data = response.data,\n          token = _response$data.token,\n          userData = _response$data.user;\n        if (!token || !userData) {\n          throw new Error('Dados de autenticação inválidos');\n        }\n        api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        yield Promise.all([AsyncStorage.setItem('@KidsBookCreator:token', token), AsyncStorage.setItem('@KidsBookCreator:user', JSON.stringify(userData))]);\n        setUser(userData);\n      } catch (error) {\n        console.error('🔒 Login Error:', error);\n        if (error.response) {\n          var errorMessage = error.response.data.message || 'Erro ao fazer login';\n          Alert.alert('Erro de Autenticação', errorMessage);\n        } else if (error.request) {\n          Alert.alert('Erro de Conexão', 'Não foi possível conectar ao servidor. Verifique sua conexão de internet.');\n        } else {\n          Alert.alert('Erro Inesperado', 'Ocorreu um erro ao processar o login. Tente novamente.');\n        }\n        throw error;\n      } finally {\n        setLoading(false);\n      }\n    });\n    return function (_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), []);\n  var signOut = useCallback(_asyncToGenerator(function* () {\n    try {\n      yield AsyncStorage.removeItem('@KidsBookCreator:token');\n      yield AsyncStorage.removeItem('@KidsBookCreator:user');\n      delete api.defaults.headers.common['Authorization'];\n      setUser(null);\n    } catch (error) {\n      console.error('Erro ao fazer logout:', error);\n      Alert.alert('Erro', 'Não foi possível fazer logout');\n    }\n  }), []);\n  React.useEffect(function () {\n    var loadStoredUser = function () {\n      var _ref4 = _asyncToGenerator(function* () {\n        try {\n          var storedToken = yield AsyncStorage.getItem('@KidsBookCreator:token');\n          var storedUserJson = yield AsyncStorage.getItem('@KidsBookCreator:user');\n          if (storedToken && storedUserJson) {\n            var storedUser = JSON.parse(storedUserJson);\n            api.defaults.headers.common['Authorization'] = `Bearer ${storedToken}`;\n            setUser(storedUser);\n          }\n        } catch (error) {\n          console.error('Erro ao carregar usuário salvo:', error);\n        }\n      });\n      return function loadStoredUser() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n    loadStoredUser();\n  }, []);\n  return _jsx(AuthContext.Provider, {\n    value: {\n      signed: !!user,\n      user: user,\n      loading: loading,\n      signIn: signIn,\n      signOut: signOut\n    },\n    children: children\n  });\n};\nexport function useAuth() {\n  var context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}","map":{"version":3,"names":["React","createContext","useContext","useState","useCallback","AsyncStorage","Alert","api","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","loading","setLoading","signIn","_ref2","_asyncToGenerator","email","password","response","post","_response$data","data","token","userData","Error","defaults","headers","common","Promise","all","setItem","JSON","stringify","error","console","errorMessage","message","alert","request","_x","_x2","apply","arguments","signOut","removeItem","useEffect","loadStoredUser","_ref4","storedToken","getItem","storedUserJson","storedUser","parse","Provider","value","signed","useAuth","context"],"sources":["/Users/cassioreistrindade/kbc2/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { Alert } from 'react-native';\nimport api from '../services/api';\n\ninterface AuthContextData {\n  signed: boolean;\n  user: User | null;\n  loading: boolean;\n  signIn(email: string, password: string): Promise<void>;\n  signOut(): void;\n}\n\ninterface User {\n  id: string;\n  name: string;\n  email: string;\n}\n\nconst AuthContext = createContext<AuthContextData>({} as AuthContextData);\n\nexport const AuthProvider: React.FC = ({ children }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  const signIn = useCallback(async (email: string, password: string) => {\n    try {\n      setLoading(true);\n      \n      const response = await api.post('/api/auth/login', {\n        email,\n        password,\n      });\n\n      const { token, user: userData } = response.data;\n\n      if (!token || !userData) {\n        throw new Error('Dados de autenticação inválidos');\n      }\n\n      // Configurar token nos headers padrão primeiro\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n\n      // Salvar dados localmente\n      await Promise.all([\n        AsyncStorage.setItem('@KidsBookCreator:token', token),\n        AsyncStorage.setItem('@KidsBookCreator:user', JSON.stringify(userData))\n      ]);\n      \n      // Atualizar o estado do usuário por último\n      setUser(userData);\n    } catch (error) {\n      console.error('🔒 Login Error:', error);\n      \n      if (error.response) {\n        // O servidor respondeu com um status de erro\n        const errorMessage = error.response.data.message || 'Erro ao fazer login';\n        Alert.alert('Erro de Autenticação', errorMessage);\n      } else if (error.request) {\n        // A requisição foi feita, mas não houve resposta\n        Alert.alert(\n          'Erro de Conexão', \n          'Não foi possível conectar ao servidor. Verifique sua conexão de internet.'\n        );\n      } else {\n        // Algo aconteceu ao configurar a requisição\n        Alert.alert(\n          'Erro Inesperado', \n          'Ocorreu um erro ao processar o login. Tente novamente.'\n        );\n      }\n      \n      throw error;\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  const signOut = useCallback(async () => {\n    try {\n      // Remover token e usuário do AsyncStorage\n      await AsyncStorage.removeItem('@KidsBookCreator:token');\n      await AsyncStorage.removeItem('@KidsBookCreator:user');\n\n      // Limpar headers de autorização\n      delete api.defaults.headers.common['Authorization'];\n      \n      setUser(null);\n    } catch (error) {\n      console.error('Erro ao fazer logout:', error);\n      Alert.alert('Erro', 'Não foi possível fazer logout');\n    }\n  }, []);\n\n  // Carregar usuário salvo ao iniciar o app\n  React.useEffect(() => {\n    const loadStoredUser = async () => {\n      try {\n        const storedToken = await AsyncStorage.getItem('@KidsBookCreator:token');\n        const storedUserJson = await AsyncStorage.getItem('@KidsBookCreator:user');\n\n        if (storedToken && storedUserJson) {\n          const storedUser = JSON.parse(storedUserJson);\n          \n          // Configurar token nos headers\n          api.defaults.headers.common['Authorization'] = `Bearer ${storedToken}`;\n          \n          setUser(storedUser);\n        }\n      } catch (error) {\n        console.error('Erro ao carregar usuário salvo:', error);\n      }\n    };\n\n    loadStoredUser();\n  }, []);\n\n  return (\n    <AuthContext.Provider\n      value={{\n        signed: !!user,\n        user,\n        loading,\n        signIn,\n        signOut,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport function useAuth(): AuthContextData {\n  const context = useContext(AuthContext);\n\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n\n  return context;\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}