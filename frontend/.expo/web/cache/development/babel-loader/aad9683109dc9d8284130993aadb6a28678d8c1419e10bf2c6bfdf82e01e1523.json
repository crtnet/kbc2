{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useContext, useState, useCallback, useEffect } from 'react';\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { api } from \"../services/api\";\nimport { useAsyncStorage } from \"../hooks/useAsyncStorage\";\nimport { logger } from \"../utils/logger\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext({});\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useAsyncStorage = useAsyncStorage('token'),\n    token = _useAsyncStorage.storedValue,\n    setToken = _useAsyncStorage.setValue,\n    removeToken = _useAsyncStorage.removeValue;\n  var _useAsyncStorage2 = useAsyncStorage('user'),\n    userData = _useAsyncStorage2.storedValue,\n    setUserData = _useAsyncStorage2.setValue,\n    removeUserData = _useAsyncStorage2.removeValue;\n  var _useState = useState(true),\n    _useState2 = _slicedToArray(_useState, 2),\n    isLoading = _useState2[0],\n    setIsLoading = _useState2[1];\n  useEffect(function () {\n    var validateToken = function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        if (token) {\n          try {\n            var response = yield api.get('/auth/validate', {\n              headers: {\n                Authorization: `Bearer ${token}`\n              }\n            });\n            if (response.data.valid) {\n              logger.info('Token validated successfully');\n            } else {\n              logger.warn('Token is invalid');\n              yield signOut();\n            }\n          } catch (error) {\n            logger.error('Token validation failed', error);\n            yield signOut();\n          }\n        }\n        setIsLoading(false);\n      });\n      return function validateToken() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    validateToken();\n  }, [token]);\n  var signIn = useCallback(function () {\n    var _ref3 = _asyncToGenerator(function* (email, password) {\n      try {\n        setIsLoading(true);\n        var response = yield api.post('/auth/login', {\n          email: email,\n          password: password\n        });\n        var _response$data = response.data,\n          _token = _response$data.token,\n          user = _response$data.user;\n        yield setToken(_token);\n        yield setUserData(user);\n        logger.info('User signed in successfully', {\n          userId: user.id\n        });\n      } catch (error) {\n        logger.error('Sign in failed', error);\n        Alert.alert('Erro', 'Não foi possível fazer login');\n        throw error;\n      } finally {\n        setIsLoading(false);\n      }\n    });\n    return function (_x, _x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), []);\n  var signOut = useCallback(_asyncToGenerator(function* () {\n    try {\n      yield removeToken();\n      yield removeUserData();\n      logger.info('User signed out');\n    } catch (error) {\n      logger.error('Sign out failed', error);\n    }\n  }), []);\n  var signUp = useCallback(function () {\n    var _ref5 = _asyncToGenerator(function* (name, email, password) {\n      try {\n        setIsLoading(true);\n        var response = yield api.post('/auth/register', {\n          name: name,\n          email: email,\n          password: password\n        });\n        var _response$data2 = response.data,\n          _token2 = _response$data2.token,\n          user = _response$data2.user;\n        yield setToken(_token2);\n        yield setUserData(user);\n        logger.info('User registered successfully', {\n          userId: user.id\n        });\n      } catch (error) {\n        logger.error('Sign up failed', error);\n        Alert.alert('Erro', 'Não foi possível criar a conta');\n        throw error;\n      } finally {\n        setIsLoading(false);\n      }\n    });\n    return function (_x3, _x4, _x5) {\n      return _ref5.apply(this, arguments);\n    };\n  }(), []);\n  return _jsx(AuthContext.Provider, {\n    value: {\n      user: userData,\n      token: token,\n      isLoading: isLoading,\n      signIn: signIn,\n      signOut: signOut,\n      signUp: signUp\n    },\n    children: children\n  });\n};\nexport var useAuth = function useAuth() {\n  var context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};","map":{"version":3,"names":["React","createContext","useContext","useState","useCallback","useEffect","Alert","api","useAsyncStorage","logger","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useAsyncStorage","token","storedValue","setToken","setValue","removeToken","removeValue","_useAsyncStorage2","userData","setUserData","removeUserData","_useState","_useState2","_slicedToArray","isLoading","setIsLoading","validateToken","_ref2","_asyncToGenerator","response","get","headers","Authorization","data","valid","info","warn","signOut","error","apply","arguments","signIn","_ref3","email","password","post","_response$data","user","userId","id","alert","_x","_x2","signUp","_ref5","name","_response$data2","_x3","_x4","_x5","Provider","value","useAuth","context","Error"],"sources":["/Users/cassioreistrindade/kbc2/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useCallback, useEffect } from 'react';\nimport { Alert } from 'react-native';\nimport { api } from '../services/api';\nimport { useAsyncStorage } from '../hooks/useAsyncStorage';\nimport { logger } from '../utils/logger';\n\ninterface User {\n  id: string;\n  name: string;\n  email: string;\n}\n\ninterface AuthContextData {\n  user: User | null;\n  token: string | null;\n  isLoading: boolean;\n  signIn: (email: string, password: string) => Promise<void>;\n  signOut: () => Promise<void>;\n  signUp: (name: string, email: string, password: string) => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextData>({} as AuthContextData);\n\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const { storedValue: token, setValue: setToken, removeValue: removeToken } = useAsyncStorage<string>('token');\n  const { storedValue: userData, setValue: setUserData, removeValue: removeUserData } = useAsyncStorage<User>('user');\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    // Verificar se o token é válido ao iniciar o app\n    const validateToken = async () => {\n      if (token) {\n        try {\n          const response = await api.get('/auth/validate', {\n            headers: { Authorization: `Bearer ${token}` }\n          });\n          \n          if (response.data.valid) {\n            logger.info('Token validated successfully');\n          } else {\n            logger.warn('Token is invalid');\n            await signOut();\n          }\n        } catch (error) {\n          logger.error('Token validation failed', error);\n          await signOut();\n        }\n      }\n      setIsLoading(false);\n    };\n\n    validateToken();\n  }, [token]);\n\n  const signIn = useCallback(async (email: string, password: string) => {\n    try {\n      setIsLoading(true);\n      const response = await api.post('/auth/login', { email, password });\n      \n      const { token, user } = response.data;\n      \n      await setToken(token);\n      await setUserData(user);\n      \n      logger.info('User signed in successfully', { userId: user.id });\n    } catch (error) {\n      logger.error('Sign in failed', error);\n      Alert.alert('Erro', 'Não foi possível fazer login');\n      throw error;\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  const signOut = useCallback(async () => {\n    try {\n      await removeToken();\n      await removeUserData();\n      logger.info('User signed out');\n    } catch (error) {\n      logger.error('Sign out failed', error);\n    }\n  }, []);\n\n  const signUp = useCallback(async (name: string, email: string, password: string) => {\n    try {\n      setIsLoading(true);\n      const response = await api.post('/auth/register', { name, email, password });\n      \n      const { token, user } = response.data;\n      \n      await setToken(token);\n      await setUserData(user);\n      \n      logger.info('User registered successfully', { userId: user.id });\n    } catch (error) {\n      logger.error('Sign up failed', error);\n      Alert.alert('Erro', 'Não foi possível criar a conta');\n      throw error;\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  return (\n    <AuthContext.Provider value={{\n      user: userData,\n      token,\n      isLoading,\n      signIn,\n      signOut,\n      signUp\n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  \n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  \n  return context;\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}